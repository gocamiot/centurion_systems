# ───────── location_security.conf ─────────
# ❶ Block high-risk files/folders immediately (no response body)
location ~* (\.env(\.production|\.development)?$|\.aws/(credentials|config)$|\.git/.*|\.svn/.*|\.ssh/.*|\.vscode/.*|\.idea/.*|composer\.(json|lock)$|package\.json$|bower\.json$|config\.(php|ini|xml|yaml|yml|json)$|wp-config\.php$|wp-admin/setup-config\.php$|vendor/|phpunit|eval-stdin\.php$|\.bak$|\.old$|\.backup$|\.sql$|backup\.sql$|dump\.sql$|database(_backup)?\.sql$|backup\.tar\.gz$|backup\.zip$|server\.key$|\.pem$|etc/ssl/private/.*\.key$|docker-compose\.yml$|secrets\.json$|config\.yaml$|config\.yml$|cloud-config\.yml$|user_secrets\.yml$|db/schema\.rb$|settings\.py$) { return 444; }

# ❷ Any dot-file except ACME path → 444
location ~ /\.(?!well-known).* { return 444; }

# ❸ Kill obvious protocol abuse
if ($request_method = CONNECT) { return 444; }
if ($request_method !~ ^(GET|HEAD|POST|PUT|DELETE|PATCH|OPTIONS)$) { return 444; }

# ❹ Throttle generic noise (zone is defined globally)
limit_req zone=bot_ratelimit burst=50 nodelay;
